// Owo- DIY Tax Filing App
// Built with ‚ù§Ô∏è for Nigerian taxpayers

// ============================================
// Owo - Authentication System
// ============================================

console.log('üöÄ TaxNaija initializing...');

// ============================================
// GOOGLE OAUTH CONFIGURATION
// ============================================

// üîë PASTE YOUR CLIENT ID HERE (from Google Cloud Console)
const GOOGLE_CLIENT_ID = '107560824332-r11ubimm7nfadp6g8s3q9r8r4ghomp9s.apps.googleusercontent.com';
// ‚ö†Ô∏è IMPORTANT: Replace 'YOUR_CLIENT_ID_HERE' with your actual Client ID!
// Example: '123456789-abcdefg.apps.googleusercontent.com'

// ============================================
// USER STATE
// ============================================

let currentUser = null; // Will store logged-in user info

// ============================================
// LOCAL STORAGE (Database on phone)
// ============================================

const DB = {
  /**
     * Save data to browser storage
        */
          save(key, data) {
              try {
                    localStorage.setItem(key, JSON.stringify(data));
                          console.log(`‚úÖ Saved ${key}`);
                                return true;
                                    } catch (error) {
                                          console.error(`‚ùå Failed to save ${key}:`, error);
                                                return false;
                                                    }
                                                      },

                                                        /**
                                                           * Load data from browser storage
                                                              */
                                                                load(key, defaultValue = null) {
                                                                    try {
                                                                          const data = localStorage.getItem(key);
                                                                                if (data === null) return defaultValue;
                                                                                      console.log(`‚úÖ Loaded ${key}`);
                                                                                            return JSON.parse(data);
                                                                                                } catch (error) {
                                                                                                      console.error(`‚ùå Failed to load ${key}:`, error);
                                                                                                            return defaultValue;
                                                                                                                }
                                                                                                                  },

                                                                                                                    /**
                                                                                                                       * Delete data
                                                                                                                          */
                                                                                                                            delete(key) {
                                                                                                                                localStorage.removeItem(key);
                                                                                                                                    console.log(`üóëÔ∏è Deleted ${key}`);
                                                                                                                                      }
                                                                                                                                      };

                                                                                                                                      // ============================================
                                                                                                                                      // GOOGLE SIGN-IN FUNCTIONS
                                                                                                                                      // ============================================

                                                                                                                                      /**
                                                                                                                                       * Initialize Google Sign-In
                                                                                                                                        * This runs when page loads
                                                                                                                                         */
                                                                                                                                         function initGoogleSignIn() {
                                                                                                                                           console.log('üîê Initializing Google Sign-In...');

                                                                                                                                             // Check if user was previously logged in
                                                                                                                                               const savedUser = DB.load('currentUser');
                                                                                                                                                 if (savedUser) {
                                                                                                                                                     console.log('üë§ Found saved user:', savedUser.name);
                                                                                                                                                         currentUser = savedUser;
                                                                                                                                                             showMainApp();
                                                                                                                                                                 return;
                                                                                                                                                                   }

                                                                                                                                                                     // Initialize Google Sign-In button
                                                                                                                                                                       google.accounts.id.initialize({
                                                                                                                                                                           client_id: GOOGLE_CLIENT_ID,
                                                                                                                                                                               callback: handleGoogleSignIn,
                                                                                                                                                                                   auto_select: false
                                                                                                                                                                                     });

                                                                                                                                                                                       // Render the button
                                                                                                                                                                                         google.accounts.id.renderButton(
                                                                                                                                                                                             document.getElementById('googleSignInButton'),
                                                                                                                                                                                                 {
                                                                                                                                                                                                       theme: 'filled_blue',
                                                                                                                                                                                                             size: 'large',
                                                                                                                                                                                                                   text: 'continue_with',
                                                                                                                                                                                                                         shape: 'rectangular',
                                                                                                                                                                                                                               width: 400
                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                     );

                                                                                                                                                                                                                                       console.log('‚úÖ Google Sign-In ready!');
                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                       /**
                                                                                                                                                                                                                                        * Handle successful Google Sign-In
                                                                                                                                                                                                                                         * This runs when user clicks "Sign in with Google"
                                                                                                                                                                                                                                          */
                                                                                                                                                                                                                                          function handleGoogleSignIn(response) {
                                                                                                                                                                                                                                            console.log('üéâ User signed in with Google!');

                                                                                                                                                                                                                                              // Decode the JWT token to get user info
                                                                                                                                                                                                                                                const userData = parseJwt(response.credential);
                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                    currentUser = {
                                                                                                                                                                                                                                                        id: userData.sub,
                                                                                                                                                                                                                                                            email: userData.email,
                                                                                                                                                                                                                                                                name: userData.name,
                                                                                                                                                                                                                                                                    picture: userData.picture,
                                                                                                                                                                                                                                                                        provider: 'google',
                                                                                                                                                                                                                                                                            createdAt: new Date().toISOString()
                                                                                                                                                                                                                                                                              };

                                                                                                                                                                                                                                                                                console.log('üë§ User info:', currentUser);

                                                                                                                                                                                                                                                                                  // Save user to localStorage
                                                                                                                                                                                                                                                                                    DB.save('currentUser', currentUser);

                                                                                                                                                                                                                                                                                      // Show main app
                                                                                                                                                                                                                                                                                        showMainApp();

                                                                                                                                                                                                                                                                                          // Show welcome message
                                                                                                                                                                                                                                                                                            alert(`Welcome, ${currentUser.name}! üéâ`);
                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                            /**
                                                                                                                                                                                                                                                                                             * Parse JWT token
                                                                                                                                                                                                                                                                                              * (Google sends user info as encoded token)
                                                                                                                                                                                                                                                                                               */
                                                                                                                                                                                                                                                                                               function parseJwt(token) {
                                                                                                                                                                                                                                                                                                 const base64Url = token.split('.')[1];
                                                                                                                                                                                                                                                                                                   const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                                                                                                                                                                                                                                                                                                     const jsonPayload = decodeURIComponent(
                                                                                                                                                                                                                                                                                                         atob(base64)
                                                                                                                                                                                                                                                                                                               .split('')
                                                                                                                                                                                                                                                                                                                     .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
                                                                                                                                                                                                                                                                                                                           .join('')
                                                                                                                                                                                                                                                                                                                             );
                                                                                                                                                                                                                                                                                                                               return JSON.parse(jsonPayload);
                                                                                                                                                                                                                                                                                                                               }

                                                                                                                                                                                                                                                                                                                               /**
                                                                                                                                                                                                                                                                                                                                * Sign out user
                                                                                                                                                                                                                                                                                                                                 */
                                                                                                                                                                                                                                                                                                                                 function signOut() {
                                                                                                                                                                                                                                                                                                                                   if (confirm('Are you sure you want to sign out?')) {
                                                                                                                                                                                                                                                                                                                                       console.log('üëã User signing out...');
                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                               // Clear user data
                                                                                                                                                                                                                                                                                                                                                   currentUser = null;
                                                                                                                                                                                                                                                                                                                                                       DB.delete('currentUser');
                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                               // Reload page to show login screen
                                                                                                                                                                                                                                                                                                                                                                   window.location.reload();
                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                                                     }

                                                                                                                                                                                                                                                                                                                                                                     // ============================================
                                                                                                                                                                                                                                                                                                                                                                     // UI DISPLAY FUNCTIONS
                                                                                                                                                                                                                                                                                                                                                                     // ============================================

                                                                                                                                                                                                                                                                                                                                                                     /**
                                                                                                                                                                                                                                                                                                                                                                      * Show login screen
                                                                                                                                                                                                                                                                                                                                                                       */
                                                                                                                                                                                                                                                                                                                                                                       function showLoginScreen() {
                                                                                                                                                                                                                                                                                                                                                                         document.getElementById('loginScreen').style.display = 'flex';
                                                                                                                                                                                                                                                                                                                                                                           document.getElementById('mainApp').style.display = 'none';
                                                                                                                                                                                                                                                                                                                                                                           }

                                                                                                                                                                                                                                                                                                                                                                           /**
                                                                                                                                                                                                                                                                                                                                                                            * Show main app (user is logged in)
                                                                                                                                                                                                                                                                                                                                                                             */
                                                                                                                                                                                                                                                                                                                                                                             function showMainApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
  
  // Render the current page
  renderApp();
  
  console.log('‚úÖ Main app displayed');
}
                                                                                                                                                                                                                                                                                                                                                                                     /**
                                                                                                                                                                                                                                                                                                                                                                                      * Show email login (placeholder for Day 2)
                                                                                                                                                                                                                                                                                                                                                                                       */
                                                                                                                                                                                                                                                                                                                                                                                       function showEmailLogin() {
                                                                                                                                                                                                                                                                                                                                                                                         alert('üìß Email login coming tomorrow! Use Google for now.');
                                                                                                                                                                                                                                                                                                                                                                                         }

                                                                                                                                                                                                                                                                                                                                                                                         // ============================================
                                                                                                                                                                                                                                                                                                                                                                                         // INITIALIZE APP ON PAGE LOAD
                                                                                                                                                                                                                                                                                                                                                                                         // ============================================

                                                                                                                                                                                                                                                                                                                                                                                         window.onload = function() {
                                                                                                                                                                                                                                                                                                                                                                                           console.log('üì± Page loaded, starting app...');
                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                               // Wait for Google library to load
                                                                                                                                                                                                                                                                                                                                                                                                 if (typeof google !== 'undefined') {
                                                                                                                                                                                                                                                                                                                                                                                                     initGoogleSignIn();
                                                                                                                                                                                                                                                                                                                                                                                                       } else {
                                                                                                                                                                                                                                                                                                                                                                                                           // Google library not loaded yet, wait 1 second
                                                                                                                                                                                                                                                                                                                                                                                                               console.log('‚è≥ Waiting for Google library...');
                                                                                                                                                                                                                                                                                                                                                                                                                   setTimeout(initGoogleSignIn, 1000);
                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                                                                                                     };
// ============================================
// APP STATE (Data Storage)
// ============================================

const AppState = {
  currentPage: 'dashboard',
    transactions: DB.load('transactions', []),
      categories: DB.load('categories', [
          { id: 'business', name: 'Business', icon: 'üíº', color: '#3b82f6', taxRule: 'deductible' },
              { id: 'personal', name: 'Personal', icon: 'üë§', color: '#8b5cf6', taxRule: 'neutral' },
                  { id: 'utilities', name: 'Utilities', icon: 'üí°', color: '#f59e0b', taxRule: 'deductible' },
                      { id: 'transport', name: 'Transport', icon: 'üöó', color: '#10b981', taxRule: 'deductible' },
                          { id: 'food', name: 'Food', icon: 'üçΩÔ∏è', color: '#f97316', taxRule: 'neutral' },
                              { id: 'healthcare', name: 'Healthcare', icon: '‚öïÔ∏è', color: '#ef4444', taxRule: 'deductible' }
                                ]),
                                  isPremium: DB.load('isPremium', false),
                                    trialEndsAt: DB.load('trialEndsAt', null)
                                    };

                                    // ============================================
                                    // NAVIGATION
                                    // ============================================

                                    /**
                                     * Navigate to different page
                                      */
                                      function navigateTo(pageName) {
                                        console.log(`üß≠ Navigating to: ${pageName}`);
                                          AppState.currentPage = pageName;
                                            renderApp();
                                              window.scrollTo(0, 0);
                                              }

                                              /**
                                               * Bottom navigation bar
                                                */
                                                function BottomNav() {
                                                  const pages = [
                                                      { id: 'dashboard', icon: 'üè†', label: 'Home' },
                                                          { id: 'transactions', icon: 'üìù', label: 'Transactions' },
                                                              { id: 'analytics', icon: 'üìä', label: 'Analytics' },
                                                                  { id: 'invoices', icon: 'üìÑ', label: 'Invoices' },
                                                                      { id: 'settings', icon: '‚öôÔ∏è', label: 'Settings' }
                                                                        ];

                                                                          return `
                                                                              <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50">
                                                                                    <div class="flex justify-around items-center h-16">
                                                                                            ${pages.map(page => `
                                                                                                      <button 
                                                                                                                  onclick="navigateTo('${page.id}')"
                                                                                                                              class="flex flex-col items-center justify-center flex-1 h-full transition-all ${
                                                                                                                                            AppState.currentPage === page.id
                                                                                                                                                            ? 'text-primary-600 scale-110'
                                                                                                                                                                            : 'text-gray-400'
                                                                                                                                                                                        }"
                                                                                                                                                                                                  >
                                                                                                                                                                                                              <span class="text-2xl mb-1">${page.icon}</span>
                                                                                                                                                                                                                          <span class="text-xs font-medium">${page.label}</span>
                                                                                                                                                                                                                                    </button>
                                                                                                                                                                                                                                            `).join('')}
                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                      </nav>
                                                                                                                                                                                                                                                        `;
                                                                                                                                                                                                                                                        }
 // ============================================
 // DASHBOARD PAGE
 // ============================================

 function DashboardPage() {
   const stats = calculateStats();
     const user = currentUser;

       return `
           <div class="min-h-screen pb-20 bg-gray-50">

                       <!-- Header -->
                             <header class="bg-gradient-to-br from-primary-600 to-primary-700 text-white p-6 rounded-b-3xl shadow-lg">
                                     <div class="flex justify-between items-start mb-6">
                                               <div class="flex items-center">
                                                           <img src="${user.picture}" alt="${user.name}" class="w-12 h-12 rounded-full border-2 border-white mr-3">
                                                                       <div>
                                                                                     <h1 class="text-xl font-bold">Hi, ${user.name.split(' ')[0]}! üëã</h1>
                                                                                                   <p class="text-primary-100 text-sm">Let's file your taxes</p>
                                                                                                               </div>
                                                                                                                         </div>
                                                                                                                                   <button onclick="navigateTo('settings')" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                                                                                                                               ‚öôÔ∏è
                                                                                                                                                         </button>
                                                                                                                                                                 </div>

                                                                                                                                                                         <!-- Summary Cards -->
                                                                                                                                                                                 <div class="grid grid-cols-3 gap-3">
                                                                                                                                                                                           <div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">
                                                                                                                                                                                                       <div class="text-2xl mb-1">üí≥</div>
                                                                                                                                                                                                                   <div class="text-2xl font-bold">${stats.totalTransactions}</div>
                                                                                                                                                                                                                               <div class="text-xs text-primary-100 mt-1">Transactions</div>
                                                                                                                                                                                                                                         </div>

                                                                                                                                                                                                                                                             <div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">
                                                                                                                                                                                                                                                                         <div class="text-2xl mb-1">${stats.taggedPercent === 100 ? 'üéâ' : stats.taggedPercent > 50 ? '‚úÖ' : '‚ö†Ô∏è'}</div>
                                                                                                                                                                                                                                                                                     <div class="text-2xl font-bold">${stats.taggedPercent}%</div>
                                                                                                                                                                                                                                                                                                 <div class="text-xs text-primary-100 mt-1">Tagged</div>
                                                                                                                                                                                                                                                                                                           </div>

                                                                                                                                                                                                                                                                                                                               <div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">
                                                                                                                                                                                                                                                                                                                                           <div class="text-2xl mb-1">üí∞</div>
                                                                                                                                                                                                                                                                                                                                                       <div class="text-lg font-bold">${formatCurrency(stats.estimatedTax)}</div>
                                                                                                                                                                                                                                                                                                                                                                   <div class="text-xs text-primary-100 mt-1">Est. Tax</div>
                                                                                                                                                                                                                                                                                                                                                                             </div>
                                                                                                                                                                                                                                                                                                                                                                                     </div>
                                                                                                                                                                                                                                                                                                                                                                                           </header>

                                                                                                                                                                                                                                                                                                                                                                                                 <!-- Main Content -->
                                                                                                                                                                                                                                                                                                                                                                                                       <div class="p-4 space-y-4">

                                                                                                                                                                                                                                                                                                                                                                                                                       <!-- Premium Banner (if not premium) -->
                                                                                                                                                                                                                                                                                                                                                                                                                               ${!AppState.isPremium ? `
                                                                                                                                                                                                                                                                                                                                                                                                                                         <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-4 text-white shadow-lg">
                                                                                                                                                                                                                                                                                                                                                                                                                                                     <div class="flex items-center justify-between">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <div class="flex-1">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <h3 class="font-bold text-lg mb-1">‚≠ê Try Premium FREE for 7 days!</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <p class="text-sm text-white/90">AI tax optimization ‚Ä¢ Unlimited features ‚Ä¢ No ads</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <button onclick="showPremiumOffer()" class="bg-white text-orange-600 px-4 py-2 rounded-xl font-semibold whitespace-nowrap ml-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Start Trial
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ` : ''}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <!-- Quick Actions -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     <h2 class="font-bold text-gray-800 text-lg mb-3">‚ö° Quick Actions</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <div class="grid grid-cols-2 gap-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <button onclick="navigateTo('transactions')" class="bg-primary-50 text-primary-700 p-4 rounded-xl font-medium hover:bg-primary-100 active:scale-95 transition-all flex flex-col items-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="text-3xl mb-2">üì§</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="text-sm">Upload CSV</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </button>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <button onclick="addTestData()" class="bg-green-50 text-green-700 p-4 rounded-xl font-medium hover:bg-green-100 active:scale-95 transition-all flex flex-col items-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="text-3xl mb-2">üß™</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="text-sm">Test Data</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </button>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <button onclick="navigateTo('analytics')" class="bg-purple-50 text-purple-700 p-4 rounded-xl font-medium hover:bg-purple-100 active:scale-95 transition-all flex flex-col items-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="text-3xl mb-2">üìä</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="text-sm">Analytics</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </button>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <button onclick="navigateTo('invoices')" class="bg-blue-50 text-blue-700 p-4 rounded-xl font-medium hover:bg-blue-100 active:scale-95 transition-all flex flex-col items-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="text-3xl mb-2">üìÑ</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="text-sm">Invoices</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </section>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <!-- Recent Transactions -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <h2 class="font-bold text-gray-800 text-lg mb-3">üìú Recent Transactions</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ${stats.totalTransactions === 0 ? `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     <div class="text-center py-8">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <div class="text-6xl mb-4">üìÇ</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <p class="text-gray-600 mb-4">No transactions yet</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <button onclick="addTestData()" class="bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Add Test Data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ` : `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <div class="space-y-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ${AppState.transactions.slice(0, 5).map(txn => `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <div class="flex items-center flex-1">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <div class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-xl mr-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ${txn.category ? getCategoryById(txn.category).icon : 'üìÑ'}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <div class="flex-1 min-w-0">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <div class="font-medium text-gray-800 truncate">${txn.description}</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <div class="text-xs text-gray-500">${formatDate(txn.date)}</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     <div class="text-right ml-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <div class="font-bold ${txn.amount >= 0 ? 'text-green-600' : 'text-red-600'}">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ${txn.amount >= 0 ? '+' : ''}${formatCurrency(txn.amount)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   `).join('')}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         `}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </section>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             // ============================================
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             // HELPER FUNCTIONS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             // ============================================

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             function calculateStats() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               const txns = AppState.transactions;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 const taggedCount = txns.filter(t => t.isTagged).length;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   const taggedPercent = txns.length > 0 ? Math.round((taggedCount / txns.length) * 100) : 0;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       const totalIncome = txns.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         const deductible = txns
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             .filter(t => t.amount < 0 && t.category && getCategoryById(t.category)?.taxRule === 'deductible')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 .reduce((sum, t) => sum + Math.abs(t.amount), 0);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     // Simple 2026 tax calculation (we'll make it accurate tomorrow)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       const taxableIncome = totalIncome - deductible;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         const estimatedTax = calculateTax2026(taxableIncome);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             return {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 totalTransactions: txns.length,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     taggedCount,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         taggedPercent,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             estimatedTax
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }                                                                                                                                                                                                                                                 
// Will add code here shortly!
// ============================================
// MAIN RENDER FUNCTION
// ============================================

function renderApp() {
  if (!currentUser) {
      showLoginScreen();
          return;
            }

              const mainApp = document.getElementById('mainApp');
                
                  let pageContent = '';
                    
                      switch(AppState.currentPage) {
                          case 'dashboard':
                                pageContent = DashboardPage();
                                      break;
                                          case 'transactions':
                                                pageContent = '<div class="p-20 text-center text-gray-600">Transactions page - Day 2!</div>';
                                                      break;
                                                          case 'analytics':
                                                                pageContent = '<div class="p-20 text-center text-gray-600">Analytics page - Day 4!</div>';
                                                                      break;
                                                                          case 'invoices':
                                                                                pageContent = '<div class="p-20 text-center text-gray-600">Invoices page - Day 5!</div>';
                                                                                      break;
                                                                                          case 'settings':
                                                                                                pageContent = SettingsPage();
                                                                                                      break;
                                                                                                          default:
                                                                                                                pageContent = DashboardPage();
                                                                                                                  }
                                                                                                                    
                                                                                                                      mainApp.innerHTML = pageContent + BottomNav();
                                                                                                                      }

                                                                                                                      // ============================================
                                                                                                                      // SETTINGS PAGE (Basic version)
                                                                                                                      // ============================================

                                                                                                                      function SettingsPage() {
                                                                                                                        const user = currentUser;
                                                                                                                          
                                                                                                                            return `
                                                                                                                                <div class="min-h-screen pb-20 bg-gray-50">
                                                                                                                                      <header class="bg-primary-600 text-white p-6">
                                                                                                                                              <h1 class="text-2xl font-bold">Settings</h1>
                                                                                                                                                    </header>
                                                                                                                                                          
                                                                                                                                                                <div class="p-4 space-y-4">
                                                                                                                                                                        <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                  <h2 class="font-bold text-gray-800 mb-4">Profile</h2>
                                                                                                                                                                                            <div class="flex items-center mb-4">
                                                                                                                                                                                                        <img src="${user.picture}" alt="${user.name}" class="w-16 h-16 rounded-full mr-4">
                                                                                                                                                                                                                    <div>
                                                                                                                                                                                                                                  <div class="font-bold text-gray-900">${user.name}</div>
                                                                                                                                                                                                                                                <div class="text-sm text-gray-600">${user.email}</div>
                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                              </section>

                                                                                                                                                                                                                                                                                      <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                                                                                                                                <h2 class="font-bold text-gray-800 mb-4">Premium Status</h2>
                                                                                                                                                                                                                                                                                                          <div class="flex items-center justify-between">
                                                                                                                                                                                                                                                                                                                      <div>
                                                                                                                                                                                                                                                                                                                                    <div class="font-medium">${AppState.isPremium ? 'üíé Premium Member' : 'üÜì Free Plan'}</div>
                                                                                                                                                                                                                                                                                                                                                  <div class="text-sm text-gray-600">${AppState.isPremium ? 'All features unlocked' : 'Limited to 50 transactions/month'}</div>
                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                          ${!AppState.isPremium ? `
                                                                                                                                                                                                                                                                                                                                                                                        <button onclick="showPremiumOffer()" class="bg-primary-600 text-white px-4 py-2 rounded-xl font-medium">
                                                                                                                                                                                                                                                                                                                                                                                                        Upgrade
                                                                                                                                                                                                                                                                                                                                                                                                                      </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                  ` : ''}
                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </section>

                                                                                                                                                                                                                                                                                                                                                                                                                                                            <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <h2 class="font-bold text-gray-800 mb-4">Account</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <button onclick="signOut()" class="w-full bg-red-600 text-white py-3 rounded-xl font-medium hover:bg-red-700">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Sign Out
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </section>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <section class="bg-white rounded-2xl shadow-md p-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="text-center text-gray-600 text-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="mb-2">TaxNaija v1.0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div>Made with ‚ù§Ô∏è for Nigerian taxpayers</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </section>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                