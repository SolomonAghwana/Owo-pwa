console.log('üöÄ Owo starting...');
const GOOGLE_CLIENT_ID = '107560824332-r11ubimm7nfadp6g8s3q9r8r4ghomp9s.apps.googleusercontent.com';
let currentUser = null;
const DB = {save: function(key, data) {try {localStorage.setItem(key, JSON.stringify(data)); console.log('‚úÖ Saved ' + key); return true;} catch (error) {console.error('‚ùå Save failed:', error); return false;}}, load: function(key, defaultValue) {if (defaultValue === undefined) defaultValue = null; try {const data = localStorage.getItem(key); if (data === null) return defaultValue; return JSON.parse(data);} catch (error) {console.error('‚ùå Load failed:', error); return defaultValue;}}, delete: function(key) {localStorage.removeItem(key); console.log('üóëÔ∏è Deleted ' + key);}};
const AppState = {currentPage: 'dashboard', transactions: [], categories: [{id: 'business', name: 'Business', icon: 'üíº', color: '#3b82f6', taxRule: 'deductible'}, {id: 'personal', name: 'Personal', icon: 'üë§', color: '#8b5cf6', taxRule: 'neutral'}, {id: 'utilities', name: 'Utilities', icon: 'üí°', color: '#f59e0b', taxRule: 'deductible'}, {id: 'transport', name: 'Transport', icon: 'üöó', color: '#10b981', taxRule: 'deductible'}, {id: 'food', name: 'Food', icon: 'üçΩÔ∏è', color: '#f97316', taxRule: 'neutral'}, {id: 'healthcare', name: 'Healthcare', icon: '‚öïÔ∏è', color: '#ef4444', taxRule: 'deductible'}], isPremium: false, trialEndsAt: null};
function initGoogleSignIn() {console.log('üîê Initializing Google Sign-In...'); const savedUser = DB.load('currentUser'); if (savedUser) {console.log('üë§ Found saved user:', savedUser.name); currentUser = savedUser; showMainApp(); return;} if (typeof google === 'undefined') {console.log('‚è≥ Google library not loaded yet...'); setTimeout(initGoogleSignIn, 1000); return;} google.accounts.id.initialize({client_id: GOOGLE_CLIENT_ID, callback: handleGoogleSignIn}); google.accounts.id.renderButton(document.getElementById('googleSignInButton'), {theme: 'filled_blue', size: 'large', text: 'continue_with', shape: 'rectangular', width: 300}); console.log('‚úÖ Google Sign-In ready');}
function handleGoogleSignIn(response) {console.log('üéâ User signed in!'); const userData = parseJwt(response.credential); currentUser = {id: userData.sub, email: userData.email, name: userData.name, picture: userData.picture, provider: 'google', createdAt: new Date().toISOString()}; DB.save('currentUser', currentUser); showMainApp(); alert('Welcome, ' + currentUser.name + '! üéâ');}
function parseJwt(token) {const base64Url = token.split('.')[1]; const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/'); const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);}).join('')); return JSON.parse(jsonPayload);}
function signOut() {if (confirm('Sign out?')) {currentUser = null; DB.delete('currentUser'); window.location.reload();}}
var authMode='signin';function showEmailModal(){document.getElementById('emailModal').style.display='flex';authMode='signin';updateAuthModal();}function closeEmailModal(){document.getElementById('emailModal').style.display='none';document.getElementById('authForm').reset();document.getElementById('errorMessage').style.display='none';}function toggleAuthMode(){authMode=authMode==='signin'?'signup':'signin';updateAuthModal();}function updateAuthModal(){var isSignup=authMode==='signup';document.getElementById('modalTitle').textContent=isSignup?'Sign Up':'Sign In';document.getElementById('authButton').textContent=isSignup?'Create Account':'Sign In';document.getElementById('toggleButton').textContent=isSignup?"Already have an account? Sign In":"Don't have an account? Sign Up";document.getElementById('nameField').style.display=isSignup?'block':'none';if(isSignup){document.getElementById('nameInput').required=true;}else{document.getElementById('nameInput').required=false;}}function handleEmailAuth(event){event.preventDefault();var email=document.getElementById('emailInput').value.trim();var password=document.getElementById('passwordInput').value;var name=document.getElementById('nameInput').value.trim();var errorDiv=document.getElementById('errorMessage');errorDiv.style.display='none';if(!email||!password){showError('Please fill in all required fields');return;}if(password.length<6){showError('Password must be at least 6 characters');return;}if(authMode==='signup'){if(!name){showError('Please enter your full name');return;}var existingUser=DB.load('user_'+email);if(existingUser){showError('An account with this email already exists');return;}var newUser={email:email,password:btoa(password),name:name,picture:'https://ui-avatars.com/api/?name='+encodeURIComponent(name)+'&background=2563eb&color=fff',provider:'email',createdAt:new Date().toISOString()};DB.save('user_'+email,newUser);currentUser={id:email,email:email,name:name,picture:newUser.picture,provider:'email',createdAt:newUser.createdAt};DB.save('currentUser',currentUser);closeEmailModal();showMainApp();alert('Welcome, '+name+'! üéâ');}else{var savedUser=DB.load('user_'+email);if(!savedUser){showError('No account found with this email');return;}if(savedUser.password!==btoa(password)){showError('Incorrect password');return;}currentUser={id:savedUser.email,email:savedUser.email,name:savedUser.name,picture:savedUser.picture,provider:'email',createdAt:savedUser.createdAt};DB.save('currentUser',currentUser);closeEmailModal();showMainApp();alert('Welcome back, '+savedUser.name+'! üëã');}}function showError(message){var errorDiv=document.getElementById('errorMessage');errorDiv.textContent=message;errorDiv.style.display='block';}
function showLoginScreen() {document.getElementById('loginScreen').style.display = 'flex'; document.getElementById('mainApp').style.display = 'none';initGoogleSignIn();}
function showMainApp() {document.getElementById('loginScreen').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; renderApp(); console.log('‚úÖ Main app displayed');}
function navigateTo(pageName) {console.log('üß≠ Navigating to: ' + pageName); AppState.currentPage = pageName; renderApp(); window.scrollTo(0, 0);}
function formatCurrency(amount) {return '‚Ç¶' + Math.abs(amount).toLocaleString('en-NG');}
function formatDate(date) {return new Date(date).toLocaleDateString('en-GB', {day: 'numeric', month: 'short', year: 'numeric'});}
function getCategoryById(id) {for (var i = 0; i < AppState.categories.length; i++) {if (AppState.categories[i].id === id) {return AppState.categories[i];}} return null;}
function calculateStats() {var txns = AppState.transactions; var taggedCount = 0; var totalIncome = 0; var deductible = 0; for (var i = 0; i < txns.length; i++) {if (txns[i].isTagged) taggedCount++; if (txns[i].amount > 0) totalIncome += txns[i].amount; if (txns[i].amount < 0 && txns[i].category) {var cat = getCategoryById(txns[i].category); if (cat && cat.taxRule === 'deductible') {deductible += Math.abs(txns[i].amount);}}} var taggedPercent = txns.length > 0 ? Math.round((taggedCount / txns.length) * 100) : 0; var taxableIncome = totalIncome - deductible; var estimatedTax = calculateTax2026(taxableIncome); return {totalTransactions: txns.length, taggedCount: taggedCount, taggedPercent: taggedPercent, estimatedTax: estimatedTax};}
function calculateTax2026(income) {if (income <= 800000) return 0; if (income <= 3000000) return (income - 800000) * 0.15; if (income <= 12000000) return 330000 + (income - 3000000) * 0.18; if (income <= 25000000) return 1950000 + (income - 12000000) * 0.21; if (income <= 50000000) return 4680000 + (income - 25000000) * 0.23; return 10430000 + (income - 50000000) * 0.25;}
function addTestData(){var testTxns=[{id:generateId(),date:new Date('2024-12-20').toISOString(),description:'GTBank Salary Payment',amount:250000,category:'business',isTagged:true,sender:'GTBank',recipient:'Me',type:'income',taxStatus:'taxable',notes:'Monthly salary',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:generateId(),date:new Date('2024-12-22').toISOString(),description:'Shoprite - Groceries',amount:-15000,category:'food',isTagged:true,sender:'Me',recipient:'Shoprite',type:'expense',taxStatus:'neutral',notes:'Weekly shopping',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:generateId(),date:new Date('2024-12-23').toISOString(),description:'Uber Ride to Office',amount:-3500,category:'transport',isTagged:true,sender:'Me',recipient:'Uber',type:'expense',taxStatus:'deductible',notes:'Business travel',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:generateId(),date:new Date('2024-12-24').toISOString(),description:'DSTV Premium Subscription',amount:-9600,category:'utilities',isTagged:true,sender:'Me',recipient:'DSTV',type:'expense',taxStatus:'neutral',notes:'',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:generateId(),date:new Date('2024-12-25').toISOString(),description:'Freelance Client Payment',amount:150000,category:'business',isTagged:true,sender:'Client',recipient:'Me',type:'income',taxStatus:'taxable',notes:'Website project',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}];AppState.transactions=AppState.transactions.concat(testTxns);DB.save('transactions',AppState.transactions);renderApp();alert('‚úÖ Added '+testTxns.length+' transactions!');}function generateId(){return'txn_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);}
function showPremiumOffer() var tinderCards=[];var currentTinderIndex=0;var tinderStartX=0;var tinderStartY=0;function showExpenseTinder(){tinderCards=AppState.transactions.filter(function(t){return!t.isTagged;});if(tinderCards.length===0){alert('üéâ All transactions are already categorized!');return;}currentTinderIndex=0;document.getElementById('expenseTinderModal').style.display='flex';renderTinderCard();renderTinderCategoryButtons();updateTinderCounter();}function closeExpenseTinder(){document.getElementById('expenseTinderModal').style.display='none';tinderCards=[];currentTinderIndex=0;}function renderTinderCard(){var container=document.getElementById('tinderCardContainer');if(currentTinderIndex>=tinderCards.length){container.innerHTML='<div class="absolute inset-0 flex flex-col items-center justify-center text-center"><div class="text-6xl mb-4">üéâ</div><h3 class="text-2xl font-bold text-white mb-2">All Done!</h3><p class="text-white/90 mb-6">You\'ve categorized all transactions!</p><button onclick="closeExpenseTinder()" class="bg-white text-primary-600 px-6 py-3 rounded-xl font-semibold">Close</button></div>';return;}var txn=tinderCards[currentTinderIndex];var isIncome=txn.amount>0;var html='<div id="tinderCard" class="absolute inset-0 bg-white rounded-3xl shadow-2xl p-6 flex flex-col justify-between" style="touch-action:none;">';html+='<div><div class="text-4xl mb-3">'+(isIncome?'üí∞':'üí∏')+'</div>';html+='<h3 class="text-2xl font-bold text-gray-900 mb-2">'+txn.description+'</h3>';html+='<div class="text-3xl font-bold mb-2" style="color:'+(isIncome?'#10b981':'#ef4444')+'">'+(isIncome?'+':'')+ formatCurrency(txn.amount)+'</div>';html+='<div class="text-sm text-gray-500">'+formatDate(txn.date)+'</div></div>';html+='<div class="space-y-2"><div class="text-center text-gray-400 text-sm mb-3">üëà Swipe or tap category üëâ</div></div></div>';container.innerHTML=html;var card=document.getElementById('tinderCard');card.addEventListener('touchstart',handleTinderTouchStart);card.addEventListener('touchmove',handleTinderTouchMove);card.addEventListener('touchend',handleTinderTouchEnd);}function renderTinderCategoryButtons(){var container=document.getElementById('tinderCategoryButtons');var html='';for(var i=0;i<Math.min(6,AppState.categories.length);i++){var cat=AppState.categories[i];html+='<button onclick="categorizeTinderCard(\''+cat.id+'\')" class="px-3 py-2 bg-white/20 hover:bg-white/30 rounded-xl font-medium text-sm text-white transition-all">'+cat.icon+'<br><span class="text-xs">'+cat.name+'</span></button>';}container.innerHTML=html;}function updateTinderCounter(){var remaining=tinderCards.length-currentTinderIndex;document.getElementById('tinderCounter').textContent=remaining+' remaining';}function handleTinderTouchStart(e){tinderStartX=e.touches[0].clientX;tinderStartY=e.touches[0].clientY;}function handleTinderTouchMove(e){if(!tinderStartX||!tinderStartY)return;var card=document.getElementById('tinderCard');var deltaX=e.touches[0].clientX-tinderStartX;var deltaY=e.touches[0].clientY-tinderStartY;var rotation=deltaX/10;card.style.transform='translateX('+deltaX+'px) translateY('+deltaY+'px) rotate('+rotation+'deg)';if(Math.abs(deltaX)>50){card.style.opacity=0.7;}else{card.style.opacity=1;}}function handleTinderTouchEnd(e){var card=document.getElementById('tinderCard');var deltaX=e.changedTouches[0].clientX-tinderStartX;var deltaY=e.changedTouches[0].clientY-tinderStartY;if(Math.abs(deltaX)>100){if(deltaX>0){categorizeTinderCard(AppState.categories[0].id);}else{categorizeTinderCard(AppState.categories[1].id);}}else if(deltaY<-100){skipCurrentTinderCard();}else{card.style.transform='';card.style.opacity=1;}tinderStartX=0;tinderStartY=0;}function categorizeTinderCard(categoryId){var txn=tinderCards[currentTinderIndex];var cat=getCategoryById(categoryId);updateTransaction(txn.id,{category:categoryId,isTagged:true,taxStatus:cat.taxRule});animateTinderCardOut();setTimeout(function(){currentTinderIndex++;updateTinderCounter();renderTinderCard();},300);}function skipCurrentTinderCard(){animateTinderCardOut();setTimeout(function(){currentTinderIndex++;updateTinderCounter();renderTinderCard();},300);}function animateTinderCardOut(){var card=document.getElementById('tinderCard');if(card){card.style.transition='transform 0.3s ease-out, opacity 0.3s';card.style.transform='translateY(-100vh)';card.style.opacity='0';}}
function BottomNav() {var pages = [{id: 'dashboard', icon: 'üè†', label: 'Home'}, {id: 'transactions', icon: 'üìù', label: 'Transactions'}, {id: 'analytics', icon: 'üìä', label: 'Analytics'}, {id: 'invoices', icon: 'üìÑ', label: 'Invoices'}, {id: 'settings', icon: '‚öôÔ∏è', label: 'Settings'}]; var html = '<nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50"><div class="flex justify-around items-center h-16">'; for (var i = 0; i < pages.length; i++) {var isActive = AppState.currentPage === pages[i].id; var activeClass = isActive ? 'text-primary-600 scale-110' : 'text-gray-400'; html += '<button onclick="navigateTo(\'' + pages[i].id + '\')" class="flex flex-col items-center justify-center flex-1 h-full transition-all ' + activeClass + '">'; html += '<span class="text-2xl mb-1">' + pages[i].icon + '</span>'; html += '<span class="text-xs font-medium">' + pages[i].label + '</span>'; html += '</button>';} html += '</div></nav>'; return html;}
function DashboardPage() {var stats = calculateStats(); var user = currentUser; var html = '<div class="min-h-screen pb-20 bg-gray-50">'; html += '<header class="bg-gradient-to-br from-primary-600 to-primary-700 text-white p-6 rounded-b-3xl shadow-lg">'; html += '<div class="flex justify-between items-start mb-6">'; html += '<div class="flex items-center">'; html += '<img src="' + user.picture + '" alt="' + user.name + '" class="w-12 h-12 rounded-full border-2 border-white mr-3">'; html += '<div>'; html += '<h1 class="text-xl font-bold">Hi, ' + user.name.split(' ')[0] + '! üëã</h1>'; html += '<p class="text-primary-100 text-sm">Let\'s file your taxes</p>'; html += '</div></div>'; html += '<button onclick="navigateTo(\'settings\')" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">‚öôÔ∏è</button>'; html += '</div>'; html += '<div class="grid grid-cols-3 gap-3">'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">üí≥</div>'; html += '<div class="text-2xl font-bold">' + stats.totalTransactions + '</div>'; html += '<div class="text-xs text-primary-100 mt-1">Transactions</div>'; html += '</div>'; var tagIcon = stats.taggedPercent === 100 ? 'üéâ' : stats.taggedPercent > 50 ? '‚úÖ' : '‚ö†Ô∏è'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">' + tagIcon + '</div>'; html += '<div class="text-2xl font-bold">' + stats.taggedPercent + '%</div>'; html += '<div class="text-xs text-primary-100 mt-1">Tagged</div>'; html += '</div>'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">üí∞</div>'; html += '<div class="text-lg font-bold">' + formatCurrency(stats.estimatedTax) + '</div>'; html += '<div class="text-xs text-primary-100 mt-1">Est. Tax</div>'; html += '</div>'; html += '</div></header>'; html += '<div class="p-4 space-y-4">'; if (!AppState.isPremium) {html += '<div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-4 text-white shadow-lg">'; html += '<div class="flex items-center justify-between">'; html += '<div class="flex-1">'; html += '<h3 class="font-bold text-lg mb-1">‚≠ê Try Premium FREE for 7 days!</h3>'; html += '<p class="text-sm text-white/90">AI tax optimization ‚Ä¢ Unlimited features</p>'; html += '</div>'; html += '<button onclick="showPremiumOffer()" class="bg-white text-orange-600 px-4 py-2 rounded-xl font-semibold whitespace-nowrap ml-3">Start Trial</button>'; html += '</div></div>';} html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 text-lg mb-3">‚ö° Quick Actions</h2>'; html += '<div class="grid grid-cols-2 gap-3">'; html += '<button onclick="navigateTo(\'transactions\')" class="bg-primary-50 text-primary-700 p-4 rounded-xl font-medium hover:bg-primary-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üì§</span><span class="text-sm">Upload CSV</span></button>'; html += '<button onclick="showExpenseTinder()" class="bg-orange-50 text-orange-700 p-4 rounded-xl font-medium hover:bg-orange-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üî•</span><span class="text-sm">Categorize</span></button>';  html += '<button onclick="addTestData()" class="bg-green-50 text-green-700 p-4 rounded-xl font-medium hover:bg-green-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üß™</span><span class="text-sm">Test Data</span></button>'; html += '<button onclick="navigateTo(\'analytics\')" class="bg-purple-50 text-purple-700 p-4 rounded-xl font-medium hover:bg-purple-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üìä</span><span class="text-sm">Analytics</span></button>'; html += '<button onclick="navigateTo(\'invoices\')" class="bg-blue-50 text-blue-700 p-4 rounded-xl font-medium hover:bg-blue-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üìÑ</span><span class="text-sm">Invoices</span></button>'; html += '</div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<div class="flex justify-between items-center mb-3"><h2 class="font-bold text-gray-800 text-lg">üìú Recent Transactions</h2>';if(!AppState.isPremium){var txnCount=AppState.transactions.length;var limitClass=txnCount>=50?'bg-red-100 text-red-700':txnCount>=40?'bg-orange-100 text-orange-700':'bg-blue-100 text-blue-700'; html+='<span class="text-xs font-semibold px-3 py-1 rounded-full '+limitClass+'">'+txnCount+'/50 üÜì</span>';}else{html+='<span class="text-xs font-semibold px-3 py-1 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white">üíé PREMIUM</span>';}html+='</div>'; if (stats.totalTransactions === 0) {html += '<div class="text-center py-8">'; html += '<div class="text-6xl mb-4">üìÇ</div>'; html += '<p class="text-gray-600 mb-4">No transactions yet</p>'; html += '<button onclick="addTestData()" class="bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700">Add Test Data</button>'; html += '</div>';} else {html += '<div class="space-y-2">'; var txns = AppState.transactions.slice(0, 5); for (var i = 0; i < txns.length; i++) {var txn = txns[i]; var cat = txn.category ? getCategoryById(txn.category) : null; var icon = cat ? cat.icon : 'üìÑ'; var amountClass = txn.amount >= 0 ? 'text-green-600' : 'text-red-600'; var amountSign = txn.amount >= 0 ? '+' : ''; html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">'; html += '<div class="flex items-center flex-1">'; html += '<div class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-xl mr-3">' + icon + '</div>'; html += '<div class="flex-1 min-w-0">'; html += '<div class="font-medium text-gray-800 truncate">' + txn.description + '</div>'; html += '<div class="text-xs text-gray-500">' + formatDate(txn.date) + '</div>'; html += '</div></div>'; html += '<div class="text-right ml-3">'; html += '<div class="font-bold ' + amountClass + '">' + amountSign + formatCurrency(txn.amount) + '</div>'; html += '</div></div>';} html += '</div>';} html += '</section></div></div>'; return html;}
function SettingsPage() {var user = currentUser; var html = '<div class="min-h-screen pb-20 bg-gray-50">'; html += '<header class="bg-primary-600 text-white p-6">'; html += '<h1 class="text-2xl font-bold">Settings</h1>'; html += '</header>'; html += '<div class="p-4 space-y-4">'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Profile</h2>'; html += '<div class="flex items-center mb-4">'; html += '<img src="' + user.picture + '" alt="' + user.name + '" class="w-16 h-16 rounded-full mr-4">'; html += '<div>'; html += '<div class="font-bold text-gray-900">' + user.name + '</div>'; html += '<div class="text-sm text-gray-600">' + user.email + '</div>'; html += '</div></div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Premium Status</h2>'; html += '<div class="flex items-center justify-between">'; html += '<div>'; html += '<div class="font-medium">' + (AppState.isPremium ? 'üíé Premium Member' : 'üÜì Free Plan') + '</div>'; html += '<div class="text-sm text-gray-600">' + (AppState.isPremium ? 'All features unlocked' : 'Limited to 50 transactions/month') + '</div>'; html += '</div>'; if (!AppState.isPremium) {html += '<button onclick="showPremiumOffer()" class="bg-primary-600 text-white px-4 py-2 rounded-xl font-medium">Upgrade</button>';} html += '</div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Account</h2>'; html += '<button onclick="signOut()" class="w-full bg-red-600 text-white py-3 rounded-xl font-medium hover:bg-red-700">Sign Out</button>'; html += '</section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<div class="text-center text-gray-600 text-sm">'; html += '<div class="mb-2">TaxNaija v1.0</div>'; html += '<div>Made with ‚ù§Ô∏è for Nigerian taxpayers</div>'; html += '</div></section>'; html += '</div></div>'; return html;}
function TransactionsPage(){var searchQuery=AppState.searchQuery||'';var filterType=AppState.filterType||'all';var sortBy=AppState.sortBy||'date';var sortOrder=AppState.sortOrder||'desc';var txns=AppState.transactions.slice();if(searchQuery){txns=searchTransactions(searchQuery);}if(filterType==='income'){txns=txns.filter(function(t){return t.amount>0;});}else if(filterType==='expense'){txns=txns.filter(function(t){return t.amount<0;});}else if(filterType==='tagged'){txns=txns.filter(function(t){return t.isTagged;});}else if(filterType==='untagged'){txns=txns.filter(function(t){return!t.isTagged;});}txns=sortTransactions(txns,sortBy,sortOrder);var html='<div class="min-h-screen pb-20 bg-gray-50">';html+='<header class="bg-primary-600 text-white p-4 sticky top-0 z-10 shadow-lg"><div class="flex items-center justify-between mb-3"><h1 class="text-2xl font-bold">Transactions</h1><button onclick="showAddTransactionModal()" class="bg-white/20 px-4 py-2 rounded-xl font-medium hover:bg-white/30 transition-colors">+ Add</button></div>';html+='<input type="text" id="txnSearch" placeholder="Search transactions..." value="'+searchQuery+'" oninput="handleSearch(this.value)" class="w-full px-4 py-2 rounded-xl text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-white"></header>';html+='<div class="p-4"><div class="flex gap-2 overflow-x-auto pb-2 mb-4">';var filters=[{id:'all',label:'All'},{id:'income',label:'Income'},{id:'expense',label:'Expenses'},{id:'tagged',label:'Tagged'},{id:'untagged',label:'Untagged'}];for(var i=0;i<filters.length;i++){var f=filters[i];var isActive=filterType===f.id;html+='<button onclick="setFilter(\''+f.id+'\')" class="px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-all '+(isActive?'bg-primary-600 text-white':'bg-white text-gray-700 hover:bg-gray-100')+'">'+f.label+'</button>';}html+='</div>';html+='<div class="bg-white rounded-xl p-3 mb-4 flex items-center justify-between"><span class="text-sm font-medium text-gray-700">Sort by:</span><select onchange="setSortBy(this.value)" class="border-0 bg-transparent font-medium text-primary-600 focus:ring-0"><option value="date" '+(sortBy==='date'?'selected':'')+'>Date</option><option value="amount" '+(sortBy==='amount'?'selected':'')+'>Amount</option><option value="description" '+(sortBy==='description'?'selected':'')+'>Description</option></select><button onclick="toggleSortOrder()" class="text-primary-600 font-bold text-xl">'+(sortOrder==='desc'?'‚Üì':'‚Üë')+'</button></div>';if(txns.length===0){html+='<div class="text-center py-12"><div class="text-6xl mb-4">üìÇ</div><h3 class="text-lg font-semibold text-gray-700 mb-2">No transactions found</h3><p class="text-gray-500 text-sm mb-6">'+(searchQuery?'Try a different search':'Add your first transaction to get started')+'</p>';if(!searchQuery){html+='<button onclick="showAddTransactionModal()" class="bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700">+ Add Transaction</button>';}html+='</div>';}else{html+='<div class="space-y-2">';for(var i=0;i<txns.length;i++){var txn=txns[i];var cat=txn.category?getCategoryById(txn.category):null;var icon=cat?cat.icon:(txn.amount>0?'üí∞':'üí∏');var amountClass=txn.amount>0?'text-green-600':'text-red-600';var amountSign=txn.amount>0?'+':'';html+='<div onclick="showTransactionDetail(\''+txn.id+'\')" class="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow active:scale-98">';html+='<div class="flex items-center justify-between">';html+='<div class="flex items-center flex-1 min-w-0">';html+='<div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl mr-3" style="background-color:'+(cat?cat.color+'20':'#e5e7eb')+'">'+icon+'</div>';html+='<div class="flex-1 min-w-0"><div class="font-semibold text-gray-900 truncate">'+txn.description+'</div>';html+='<div class="text-xs text-gray-500 flex items-center gap-2 mt-1"><span>'+formatDate(txn.date)+'</span>';if(txn.isTagged&&cat){html+='<span class="px-2 py-0.5 rounded-full text-xs" style="background-color:'+cat.color+'20;color:'+cat.color+'">'+cat.name+'</span>';}else{html+='<span class="px-2 py-0.5 rounded-full text-xs bg-orange-100 text-orange-600">Untagged</span>';}html+='</div></div></div>';html+='<div class="text-right ml-3"><div class="text-lg font-bold '+amountClass+'">'+amountSign+formatCurrency(txn.amount)+'</div></div></div></div>';}}html+='</div></div></div>';return html;}function setFilter(type){AppState.filterType=type;renderApp();}function setSortBy(value){AppState.sortBy=value;renderApp();}function toggleSortOrder(){AppState.sortOrder=AppState.sortOrder==='desc'?'asc':'desc';renderApp();}var selectedAddCategory=null;function showAddTransactionModal(){if(!canAddTransaction()){showUpgradePrompt('limit_reached');return;}document.getElementById('addTransactionModal').style.display='flex';document.getElementById('addDate').valueAsDate=new Date();renderAddCategoryButtons();selectedAddCategory=null;}function closeAddTransactionModal(){document.getElementById('addTransactionModal').style.display='none';document.getElementById('addTransactionForm').reset();document.getElementById('addTransactionError').style.display='none';document.getElementById('addTransactionDetails').style.display='none';selectedAddCategory=null;}function toggleAddTransactionDetails(){var details=document.getElementById('addTransactionDetails');var toggleText=document.getElementById('addDetailsToggleText');if(details.style.display==='none'){details.style.display='block';toggleText.textContent='‚ñ≤ Hide details';}else{details.style.display='none';toggleText.textContent='‚ñº Show more details';}}function renderAddCategoryButtons(){var container=document.getElementById('addCategoryButtons');var html='';for(var i=0;i<AppState.categories.length;i++){var cat=AppState.categories[i];html+='<button type="button" onclick="selectAddCategory(\''+cat.id+'\')" id="addCat_'+cat.id+'" class="px-4 py-3 border-2 border-gray-300 rounded-xl font-medium text-sm transition-all hover:border-primary-500" style="background-color:'+cat.color+'10">'+cat.icon+' '+cat.name+'</button>';}container.innerHTML=html;}function selectAddCategory(catId){selectedAddCategory=catId;for(var i=0;i<AppState.categories.length;i++){var btn=document.getElementById('addCat_'+AppState.categories[i].id);if(btn){btn.style.borderColor=AppState.categories[i].id===catId?'#2563eb':'#d1d5db';btn.style.borderWidth=AppState.categories[i].id===catId?'3px':'2px';}}}function handleAddTransaction(event){event.preventDefault();var amount=parseFloat(document.getElementById('addAmount').value);var description=document.getElementById('addDescription').value.trim();var date=document.getElementById('addDate').value;var sender=document.getElementById('addSender').value.trim()||'Unknown';var recipient=document.getElementById('addRecipient').value.trim()||'Unknown';var notes=document.getElementById('addNotes').value.trim();var errorDiv=document.getElementById('addTransactionError');errorDiv.style.display='none';if(!description||description.length<3){showAddError('Description must be at least 3 characters');return;}if(amount===0){showAddError('Amount cannot be zero');return;}if(new Date(date)>new Date()){showAddError('Date cannot be in the future');return;}var newTxn={date:new Date(date).toISOString(),description:description,amount:amount,category:selectedAddCategory,isTagged:selectedAddCategory!==null,sender:amount>0?sender:'Me',recipient:amount>0?'Me':recipient,type:amount>0?'income':'expense',taxStatus:selectedAddCategory?getCategoryById(selectedAddCategory).taxRule:'neutral',notes:notes};addTransaction(newTxn);closeAddTransactionModal();alert('‚úÖ Transaction added!');}function showAddError(msg){var errorDiv=document.getElementById('addTransactionError');errorDiv.textContent=msg;errorDiv.style.display='block';} function canAddTransaction(){if(AppState.isPremium){return true;}return AppState.transactions.length<50;}function showUpgradePrompt(reason){var message=reason==='limit_reached'?'üö´ Free Limit Reached!\n\nYou\'ve hit the 50-transaction limit for free accounts.\n\nUpgrade to Premium for:\n‚úÖ UNLIMITED transactions\n‚úÖ AI tax optimization\n‚úÖ Advanced analytics\n\nTry Premium FREE for 7 days!':'üíé Premium Feature\n\nThis feature requires Premium.\n\nUpgrade now for a 7-day FREE trial!';alert(message);}var selectedEditCategory=null;var currentEditId=null;function showTransactionDetail(id){var txn=getTransactionById(id);if(!txn){alert('Transaction not found');return;}currentEditId=id;selectedEditCategory=txn.category;document.getElementById('editTransactionModal').style.display='flex';document.getElementById('editTransactionId').value=id;document.getElementById('editAmount').value=txn.amount;document.getElementById('editDescription').value=txn.description;document.getElementById('editDate').value=txn.date.split('T')[0];document.getElementById('editSender').value=txn.sender||'';document.getElementById('editRecipient').value=txn.recipient||'';document.getElementById('editNotes').value=txn.notes||'';document.getElementById('editLastUpdated').textContent='Last updated: '+formatDate(txn.updatedAt);renderEditCategoryButtons();}function closeEditTransactionModal(){document.getElementById('editTransactionModal').style.display='none';document.getElementById('editTransactionForm').reset();document.getElementById('editTransactionError').style.display='none';document.getElementById('editTransactionDetails').style.display='none';currentEditId=null;selectedEditCategory=null;}function toggleEditTransactionDetails(){var details=document.getElementById('editTransactionDetails');var toggleText=document.getElementById('editDetailsToggleText');if(details.style.display==='none'){details.style.display='block';toggleText.textContent='‚ñ≤ Hide details';}else{details.style.display='none';toggleText.textContent='‚ñº Show more details';}}function renderEditCategoryButtons(){var container=document.getElementById('editCategoryButtons');var html='';for(var i=0;i<AppState.categories.length;i++){var cat=AppState.categories[i];var isSelected=cat.id===selectedEditCategory;html+='<button type="button" onclick="selectEditCategory(\''+cat.id+'\')" id="editCat_'+cat.id+'" class="px-4 py-3 border-2 rounded-xl font-medium text-sm transition-all hover:border-primary-500" style="background-color:'+cat.color+'10;border-color:'+(isSelected?'#2563eb':'#d1d5db')+';border-width:'+(isSelected?'3px':'2px')+'">'+cat.icon+' '+cat.name+'</button>';}container.innerHTML=html;}function selectEditCategory(catId){selectedEditCategory=catId;renderEditCategoryButtons();}function handleEditTransaction(event){event.preventDefault();var id=currentEditId;var amount=parseFloat(document.getElementById('editAmount').value);var description=document.getElementById('editDescription').value.trim();var date=document.getElementById('editDate').value;var sender=document.getElementById('editSender').value.trim();var recipient=document.getElementById('editRecipient').value.trim();var notes=document.getElementById('editNotes').value.trim();var errorDiv=document.getElementById('editTransactionError');errorDiv.style.display='none';if(!description||description.length<3){showEditError('Description must be at least 3 characters');return;}if(amount===0){showEditError('Amount cannot be zero');return;}if(new Date(date)>new Date()){showEditError('Date cannot be in the future');return;}var updates={amount:amount,description:description,date:new Date(date).toISOString(),category:selectedEditCategory,isTagged:selectedEditCategory!==null,sender:sender||'Unknown',recipient:recipient||'Unknown',type:amount>0?'income':'expense',taxStatus:selectedEditCategory?getCategoryById(selectedEditCategory).taxRule:'neutral',notes:notes};updateTransaction(id,updates);closeEditTransactionModal();alert('‚úÖ Transaction updated!');}function showEditError(msg){var errorDiv=document.getElementById('editTransactionError');errorDiv.textContent=msg;errorDiv.style.display='block';}function confirmDeleteTransaction(){if(confirm('üóëÔ∏è Delete this transaction?\n\nThis action cannot be undone.')){deleteTransaction(currentEditId);closeEditTransactionModal();}}
function handleSearch(value){AppState.searchQuery=value;var currentFocus=document.activeElement;renderApp();setTimeout(function(){var searchInput=document.getElementById('txnSearch');if(searchInput){searchInput.value=value;searchInput.focus();searchInput.setSelectionRange(value.length,value.length);}},0);}
function renderApp() {if (!currentUser) {showLoginScreen(); return;} var mainApp = document.getElementById('mainApp'); var pageContent = ''; if (AppState.currentPage === 'dashboard') {pageContent = DashboardPage();} else if (AppState.currentPage === 'settings') {pageContent = SettingsPage();} else {pageContent = TransactionsPage();} mainApp.innerHTML = pageContent + BottomNav();}
function initializeAppData() {console.log('üìä Loading saved data...'); var savedTransactions = DB.load('transactions', []); if (savedTransactions.length > 0) {AppState.transactions = savedTransactions; console.log('‚úÖ Loaded ' + savedTransactions.length + ' transactions');} AppState.isPremium = DB.load('isPremium', false); console.log('‚úÖ App data initialized');}
function getTransactionById(id){for(var i=0;i<AppState.transactions.length;i++){if(AppState.transactions[i].id===id){return AppState.transactions[i];}}return null;}function addTransaction(txn){if(!txn.id){txn.id=generateId();}txn.createdAt=new Date().toISOString();txn.updatedAt=new Date().toISOString();AppState.transactions.unshift(txn);DB.save('transactions',AppState.transactions);renderApp();return txn.id;}function updateTransaction(id,updates){for(var i=0;i<AppState.transactions.length;i++){if(AppState.transactions[i].id===id){for(var key in updates){AppState.transactions[i][key]=updates[key];}AppState.transactions[i].updatedAt=new Date().toISOString();DB.save('transactions',AppState.transactions);renderApp();return true;}}return false;}function deleteTransaction(id){if(!confirm('Delete this transaction?')){return false;}for(var i=0;i<AppState.transactions.length;i++){if(AppState.transactions[i].id===id){AppState.transactions.splice(i,1);DB.save('transactions',AppState.transactions);renderApp();return true;}}return false;}function searchTransactions(query){query=query.toLowerCase();var results=[];for(var i=0;i<AppState.transactions.length;i++){var txn=AppState.transactions[i];if(txn.description.toLowerCase().indexOf(query)!==-1||txn.sender.toLowerCase().indexOf(query)!==-1||txn.recipient.toLowerCase().indexOf(query)!==-1||(txn.notes&&txn.notes.toLowerCase().indexOf(query)!==-1)){results.push(txn);}}return results;}function filterTransactions(filters){var results=AppState.transactions;if(filters.type){results=results.filter(function(t){return t.type===filters.type;});}if(filters.category){results=results.filter(function(t){return t.category===filters.category;});}if(filters.isTagged!==undefined){results=results.filter(function(t){return t.isTagged===filters.isTagged;});}if(filters.startDate){results=results.filter(function(t){return new Date(t.date)>=new Date(filters.startDate);});}if(filters.endDate){results=results.filter(function(t){return new Date(t.date)<=new Date(filters.endDate);});}return results;}function sortTransactions(txns,sortBy,order){var sorted=txns.slice();sorted.sort(function(a,b){var aVal,bVal;if(sortBy==='date'){aVal=new Date(a.date).getTime();bVal=new Date(b.date).getTime();}else if(sortBy==='amount'){aVal=Math.abs(a.amount);bVal=Math.abs(b.amount);}else if(sortBy==='description'){aVal=a.description.toLowerCase();bVal=b.description.toLowerCase();}else{return 0;}if(order==='asc'){return aVal>bVal?1:-1;}else{return aVal<bVal?1:-1;}});return sorted;}
window.onload = function() {console.log('üì± Page loaded, starting app...'); initializeAppData(); if (typeof google !== 'undefined') {initGoogleSignIn();} else {console.log('‚è≥ Waiting for Google library...'); setTimeout(initGoogleSignIn, 1000);}};
console.log('‚úÖ Owo app.js loaded!');