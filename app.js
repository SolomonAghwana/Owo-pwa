console.log('üöÄ Owo starting...');
const GOOGLE_CLIENT_ID = '107560824332-r11ubimm7nfadp6g8s3q9r8r4ghomp9s.apps.googleusercontent.com';
let currentUser = null;
const DB = {save: function(key, data) {try {localStorage.setItem(key, JSON.stringify(data)); console.log('‚úÖ Saved ' + key); return true;} catch (error) {console.error('‚ùå Save failed:', error); return false;}}, load: function(key, defaultValue) {if (defaultValue === undefined) defaultValue = null; try {const data = localStorage.getItem(key); if (data === null) return defaultValue; return JSON.parse(data);} catch (error) {console.error('‚ùå Load failed:', error); return defaultValue;}}, delete: function(key) {localStorage.removeItem(key); console.log('üóëÔ∏è Deleted ' + key);}};
const AppState = {currentPage: 'dashboard', transactions: [], categories: [{id: 'business', name: 'Business', icon: 'üíº', color: '#3b82f6', taxRule: 'deductible'}, {id: 'personal', name: 'Personal', icon: 'üë§', color: '#8b5cf6', taxRule: 'neutral'}, {id: 'utilities', name: 'Utilities', icon: 'üí°', color: '#f59e0b', taxRule: 'deductible'}, {id: 'transport', name: 'Transport', icon: 'üöó', color: '#10b981', taxRule: 'deductible'}, {id: 'food', name: 'Food', icon: 'üçΩÔ∏è', color: '#f97316', taxRule: 'neutral'}, {id: 'healthcare', name: 'Healthcare', icon: '‚öïÔ∏è', color: '#ef4444', taxRule: 'deductible'}], isPremium: false, trialEndsAt: null};
function initGoogleSignIn() {console.log('üîê Initializing Google Sign-In...'); const savedUser = DB.load('currentUser'); if (savedUser) {console.log('üë§ Found saved user:', savedUser.name); currentUser = savedUser; showMainApp(); return;} if (typeof google === 'undefined') {console.log('‚è≥ Google library not loaded yet...'); setTimeout(initGoogleSignIn, 1000); return;} google.accounts.id.initialize({client_id: GOOGLE_CLIENT_ID, callback: handleGoogleSignIn}); google.accounts.id.renderButton(document.getElementById('googleSignInButton'), {theme: 'filled_blue', size: 'large', text: 'continue_with', shape: 'rectangular', width: 400}); console.log('‚úÖ Google Sign-In ready');}
function handleGoogleSignIn(response) {console.log('üéâ User signed in!'); const userData = parseJwt(response.credential); currentUser = {id: userData.sub, email: userData.email, name: userData.name, picture: userData.picture, provider: 'google', createdAt: new Date().toISOString()}; DB.save('currentUser', currentUser); showMainApp(); alert('Welcome, ' + currentUser.name + '! üéâ');}
function parseJwt(token) {const base64Url = token.split('.')[1]; const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/'); const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);}).join('')); return JSON.parse(jsonPayload);}
function signOut() {if (confirm('Sign out?')) {currentUser = null; DB.delete('currentUser'); window.location.reload();}}
var authMode='signin';function showEmailModal(){document.getElementById('emailModal').style.display='flex';authMode='signin';updateAuthModal();}function closeEmailModal(){document.getElementById('emailModal').style.display='none';document.getElementById('authForm').reset();document.getElementById('errorMessage').style.display='none';}function toggleAuthMode(){authMode=authMode==='signin'?'signup':'signin';updateAuthModal();}function updateAuthModal(){var isSignup=authMode==='signup';document.getElementById('modalTitle').textContent=isSignup?'Sign Up':'Sign In';document.getElementById('authButton').textContent=isSignup?'Create Account':'Sign In';document.getElementById('toggleButton').textContent=isSignup?"Already have an account? Sign In":"Don't have an account? Sign Up";document.getElementById('nameField').style.display=isSignup?'block':'none';if(isSignup){document.getElementById('nameInput').required=true;}else{document.getElementById('nameInput').required=false;}}function handleEmailAuth(event){event.preventDefault();var email=document.getElementById('emailInput').value.trim();var password=document.getElementById('passwordInput').value;var name=document.getElementById('nameInput').value.trim();var errorDiv=document.getElementById('errorMessage');errorDiv.style.display='none';if(!email||!password){showError('Please fill in all required fields');return;}if(password.length<6){showError('Password must be at least 6 characters');return;}if(authMode==='signup'){if(!name){showError('Please enter your full name');return;}var existingUser=DB.load('user_'+email);if(existingUser){showError('An account with this email already exists');return;}var newUser={email:email,password:btoa(password),name:name,picture:'https://ui-avatars.com/api/?name='+encodeURIComponent(name)+'&background=2563eb&color=fff',provider:'email',createdAt:new Date().toISOString()};DB.save('user_'+email,newUser);currentUser={id:email,email:email,name:name,picture:newUser.picture,provider:'email',createdAt:newUser.createdAt};DB.save('currentUser',currentUser);closeEmailModal();showMainApp();alert('Welcome, '+name+'! üéâ');}else{var savedUser=DB.load('user_'+email);if(!savedUser){showError('No account found with this email');return;}if(savedUser.password!==btoa(password)){showError('Incorrect password');return;}currentUser={id:savedUser.email,email:savedUser.email,name:savedUser.name,picture:savedUser.picture,provider:'email',createdAt:savedUser.createdAt};DB.save('currentUser',currentUser);closeEmailModal();showMainApp();alert('Welcome back, '+savedUser.name+'! üëã');}}function showError(message){var errorDiv=document.getElementById('errorMessage');errorDiv.textContent=message;errorDiv.style.display='block';}
function showLoginScreen() {document.getElementById('loginScreen').style.display = 'flex'; document.getElementById('mainApp').style.display = 'none';}
function showMainApp() {document.getElementById('loginScreen').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; renderApp(); console.log('‚úÖ Main app displayed');}
function navigateTo(pageName) {console.log('üß≠ Navigating to: ' + pageName); AppState.currentPage = pageName; renderApp(); window.scrollTo(0, 0);}
function formatCurrency(amount) {return '‚Ç¶' + Math.abs(amount).toLocaleString('en-NG');}
function formatDate(date) {return new Date(date).toLocaleDateString('en-GB', {day: 'numeric', month: 'short', year: 'numeric'});}
function getCategoryById(id) {for (var i = 0; i < AppState.categories.length; i++) {if (AppState.categories[i].id === id) {return AppState.categories[i];}} return null;}
function calculateStats() {var txns = AppState.transactions; var taggedCount = 0; var totalIncome = 0; var deductible = 0; for (var i = 0; i < txns.length; i++) {if (txns[i].isTagged) taggedCount++; if (txns[i].amount > 0) totalIncome += txns[i].amount; if (txns[i].amount < 0 && txns[i].category) {var cat = getCategoryById(txns[i].category); if (cat && cat.taxRule === 'deductible') {deductible += Math.abs(txns[i].amount);}}} var taggedPercent = txns.length > 0 ? Math.round((taggedCount / txns.length) * 100) : 0; var taxableIncome = totalIncome - deductible; var estimatedTax = calculateTax2026(taxableIncome); return {totalTransactions: txns.length, taggedCount: taggedCount, taggedPercent: taggedPercent, estimatedTax: estimatedTax};}
function calculateTax2026(income) {if (income <= 800000) return 0; if (income <= 3000000) return (income - 800000) * 0.15; if (income <= 12000000) return 330000 + (income - 3000000) * 0.18; if (income <= 25000000) return 1950000 + (income - 12000000) * 0.21; if (income <= 50000000) return 4680000 + (income - 25000000) * 0.23; return 10430000 + (income - 50000000) * 0.25;}
function addTestData() {var testTxns = [{id: 'txn_' + Date.now() + '_1', date: new Date('2024-12-20').toISOString(), description: 'GTBank Salary Payment', amount: 250000, category: 'business', isTagged: true, sender: 'GTBank', createdAt: new Date().toISOString()}, {id: 'txn_' + Date.now() + '_2', date: new Date('2024-12-22').toISOString(), description: 'Shoprite - Groceries', amount: -15000, category: 'food', isTagged: true, sender: 'Shoprite', createdAt: new Date().toISOString()}, {id: 'txn_' + Date.now() + '_3', date: new Date('2024-12-23').toISOString(), description: 'Uber Ride', amount: -3500, category: 'transport', isTagged: true, sender: 'Uber', createdAt: new Date().toISOString()}]; AppState.transactions = AppState.transactions.concat(testTxns); DB.save('transactions', AppState.transactions); renderApp(); alert('‚úÖ Added ' + testTxns.length + ' transactions!');}
function showPremiumOffer() {alert('üíé Premium trial coming on Day 6!');}
function BottomNav() {var pages = [{id: 'dashboard', icon: 'üè†', label: 'Home'}, {id: 'transactions', icon: 'üìù', label: 'Transactions'}, {id: 'analytics', icon: 'üìä', label: 'Analytics'}, {id: 'invoices', icon: 'üìÑ', label: 'Invoices'}, {id: 'settings', icon: '‚öôÔ∏è', label: 'Settings'}]; var html = '<nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50"><div class="flex justify-around items-center h-16">'; for (var i = 0; i < pages.length; i++) {var isActive = AppState.currentPage === pages[i].id; var activeClass = isActive ? 'text-primary-600 scale-110' : 'text-gray-400'; html += '<button onclick="navigateTo(\'' + pages[i].id + '\')" class="flex flex-col items-center justify-center flex-1 h-full transition-all ' + activeClass + '">'; html += '<span class="text-2xl mb-1">' + pages[i].icon + '</span>'; html += '<span class="text-xs font-medium">' + pages[i].label + '</span>'; html += '</button>';} html += '</div></nav>'; return html;}
function DashboardPage() {var stats = calculateStats(); var user = currentUser; var html = '<div class="min-h-screen pb-20 bg-gray-50">'; html += '<header class="bg-gradient-to-br from-primary-600 to-primary-700 text-white p-6 rounded-b-3xl shadow-lg">'; html += '<div class="flex justify-between items-start mb-6">'; html += '<div class="flex items-center">'; html += '<img src="' + user.picture + '" alt="' + user.name + '" class="w-12 h-12 rounded-full border-2 border-white mr-3">'; html += '<div>'; html += '<h1 class="text-xl font-bold">Hi, ' + user.name.split(' ')[0] + '! üëã</h1>'; html += '<p class="text-primary-100 text-sm">Let\'s file your taxes</p>'; html += '</div></div>'; html += '<button onclick="navigateTo(\'settings\')" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">‚öôÔ∏è</button>'; html += '</div>'; html += '<div class="grid grid-cols-3 gap-3">'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">üí≥</div>'; html += '<div class="text-2xl font-bold">' + stats.totalTransactions + '</div>'; html += '<div class="text-xs text-primary-100 mt-1">Transactions</div>'; html += '</div>'; var tagIcon = stats.taggedPercent === 100 ? 'üéâ' : stats.taggedPercent > 50 ? '‚úÖ' : '‚ö†Ô∏è'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">' + tagIcon + '</div>'; html += '<div class="text-2xl font-bold">' + stats.taggedPercent + '%</div>'; html += '<div class="text-xs text-primary-100 mt-1">Tagged</div>'; html += '</div>'; html += '<div class="bg-white/10 backdrop-blur-md rounded-xl p-3 text-center">'; html += '<div class="text-2xl mb-1">üí∞</div>'; html += '<div class="text-lg font-bold">' + formatCurrency(stats.estimatedTax) + '</div>'; html += '<div class="text-xs text-primary-100 mt-1">Est. Tax</div>'; html += '</div>'; html += '</div></header>'; html += '<div class="p-4 space-y-4">'; if (!AppState.isPremium) {html += '<div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-4 text-white shadow-lg">'; html += '<div class="flex items-center justify-between">'; html += '<div class="flex-1">'; html += '<h3 class="font-bold text-lg mb-1">‚≠ê Try Premium FREE for 7 days!</h3>'; html += '<p class="text-sm text-white/90">AI tax optimization ‚Ä¢ Unlimited features</p>'; html += '</div>'; html += '<button onclick="showPremiumOffer()" class="bg-white text-orange-600 px-4 py-2 rounded-xl font-semibold whitespace-nowrap ml-3">Start Trial</button>'; html += '</div></div>';} html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 text-lg mb-3">‚ö° Quick Actions</h2>'; html += '<div class="grid grid-cols-2 gap-3">'; html += '<button onclick="navigateTo(\'transactions\')" class="bg-primary-50 text-primary-700 p-4 rounded-xl font-medium hover:bg-primary-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üì§</span><span class="text-sm">Upload CSV</span></button>'; html += '<button onclick="addTestData()" class="bg-green-50 text-green-700 p-4 rounded-xl font-medium hover:bg-green-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üß™</span><span class="text-sm">Test Data</span></button>'; html += '<button onclick="navigateTo(\'analytics\')" class="bg-purple-50 text-purple-700 p-4 rounded-xl font-medium hover:bg-purple-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üìä</span><span class="text-sm">Analytics</span></button>'; html += '<button onclick="navigateTo(\'invoices\')" class="bg-blue-50 text-blue-700 p-4 rounded-xl font-medium hover:bg-blue-100 active:scale-95 transition-all flex flex-col items-center">'; html += '<span class="text-3xl mb-2">üìÑ</span><span class="text-sm">Invoices</span></button>'; html += '</div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 text-lg mb-3">üìú Recent Transactions</h2>'; if (stats.totalTransactions === 0) {html += '<div class="text-center py-8">'; html += '<div class="text-6xl mb-4">üìÇ</div>'; html += '<p class="text-gray-600 mb-4">No transactions yet</p>'; html += '<button onclick="addTestData()" class="bg-primary-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-primary-700">Add Test Data</button>'; html += '</div>';} else {html += '<div class="space-y-2">'; var txns = AppState.transactions.slice(0, 5); for (var i = 0; i < txns.length; i++) {var txn = txns[i]; var cat = txn.category ? getCategoryById(txn.category) : null; var icon = cat ? cat.icon : 'üìÑ'; var amountClass = txn.amount >= 0 ? 'text-green-600' : 'text-red-600'; var amountSign = txn.amount >= 0 ? '+' : ''; html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">'; html += '<div class="flex items-center flex-1">'; html += '<div class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-xl mr-3">' + icon + '</div>'; html += '<div class="flex-1 min-w-0">'; html += '<div class="font-medium text-gray-800 truncate">' + txn.description + '</div>'; html += '<div class="text-xs text-gray-500">' + formatDate(txn.date) + '</div>'; html += '</div></div>'; html += '<div class="text-right ml-3">'; html += '<div class="font-bold ' + amountClass + '">' + amountSign + formatCurrency(txn.amount) + '</div>'; html += '</div></div>';} html += '</div>';} html += '</section></div></div>'; return html;}
function SettingsPage() {var user = currentUser; var html = '<div class="min-h-screen pb-20 bg-gray-50">'; html += '<header class="bg-primary-600 text-white p-6">'; html += '<h1 class="text-2xl font-bold">Settings</h1>'; html += '</header>'; html += '<div class="p-4 space-y-4">'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Profile</h2>'; html += '<div class="flex items-center mb-4">'; html += '<img src="' + user.picture + '" alt="' + user.name + '" class="w-16 h-16 rounded-full mr-4">'; html += '<div>'; html += '<div class="font-bold text-gray-900">' + user.name + '</div>'; html += '<div class="text-sm text-gray-600">' + user.email + '</div>'; html += '</div></div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Premium Status</h2>'; html += '<div class="flex items-center justify-between">'; html += '<div>'; html += '<div class="font-medium">' + (AppState.isPremium ? 'üíé Premium Member' : 'üÜì Free Plan') + '</div>'; html += '<div class="text-sm text-gray-600">' + (AppState.isPremium ? 'All features unlocked' : 'Limited to 50 transactions/month') + '</div>'; html += '</div>'; if (!AppState.isPremium) {html += '<button onclick="showPremiumOffer()" class="bg-primary-600 text-white px-4 py-2 rounded-xl font-medium">Upgrade</button>';} html += '</div></section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<h2 class="font-bold text-gray-800 mb-4">Account</h2>'; html += '<button onclick="signOut()" class="w-full bg-red-600 text-white py-3 rounded-xl font-medium hover:bg-red-700">Sign Out</button>'; html += '</section>'; html += '<section class="bg-white rounded-2xl shadow-md p-4">'; html += '<div class="text-center text-gray-600 text-sm">'; html += '<div class="mb-2">TaxNaija v1.0</div>'; html += '<div>Made with ‚ù§Ô∏è for Nigerian taxpayers</div>'; html += '</div></section>'; html += '</div></div>'; return html;}
function renderApp() {if (!currentUser) {showLoginScreen(); return;} var mainApp = document.getElementById('mainApp'); var pageContent = ''; if (AppState.currentPage === 'dashboard') {pageContent = DashboardPage();} else if (AppState.currentPage === 'settings') {pageContent = SettingsPage();} else {pageContent = '<div class="p-20 text-center text-gray-600">Coming on Day 2-5!</div>';} mainApp.innerHTML = pageContent + BottomNav();}
function initializeAppData() {console.log('üìä Loading saved data...'); var savedTransactions = DB.load('transactions', []); if (savedTransactions.length > 0) {AppState.transactions = savedTransactions; console.log('‚úÖ Loaded ' + savedTransactions.length + ' transactions');} AppState.isPremium = DB.load('isPremium', false); console.log('‚úÖ App data initialized');}
window.onload = function() {console.log('üì± Page loaded, starting app...'); initializeAppData(); if (typeof google !== 'undefined') {initGoogleSignIn();} else {console.log('‚è≥ Waiting for Google library...'); setTimeout(initGoogleSignIn, 1000);}};
console.log('‚úÖ Owo app.js loaded!');